{% extends "base.html" %}

{% block title %}{{ section.title }} - {{ config.title }}{% endblock %}

{% block content %}
<h1>Kalendarz wydarzeń</h1>

<div id="calendar"></div>

<h2>Lista wydarzeń</h2>
<div id="events-list"></div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<style>
    #calendar {
        background: #FFE600;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 2rem;
        border: 2px solid #000;
    }
    .fc {
        --fc-border-color: #000 !important;
        --fc-today-bg-color: rgba(255, 140, 0, 0.2);
        --fc-page-bg-color: #FFE600;
        --fc-neutral-bg-color: #FFE600;
        --fc-list-event-hover-bg-color: #FFE600;
    }
    .fc-theme-standard td, .fc-theme-standard th {
        border-color: #000 !important;
    }
    .fc .fc-daygrid-day-number {
        color: #000;
    }
    .fc .fc-col-header-cell-cushion {
        color: #000;
    }
    .fc .fc-daygrid-day.fc-day-today {
        background-color: rgba(255, 140, 0, 0.2);
    }
    .fc-event {
        cursor: pointer;
        background-color: #000 !important;
        border-color: #000 !important;
        color: #FFE600 !important;
    }
    .fc-event-dot {
        border-color: #FF0000 !important;
    }
    .fc-daygrid-event-dot {
        border-color: #FF0000 !important;
    }
    .fc-v-event {
        background-colorimportant;
        border: #000 !-color: #000 !important;
    }
    .fc-list-event:hover td {
        background-color: #FFE600 !important;
    }
    .fc-list-day-cushion {
        background-color: #FFE600 !important;
    }
    .fc-list-event-title a {
        color: #000 !important;
    }
    .fc-button {
        background-color: #000 !important;
        border-color: #000 !important;
        color: #FFE600 !important;
    }
    .fc-button:hover {
        background-color: #333 !important;
    }
    .fc-button-active {
        background-color: #FF8C00 !important;
    }
    .fc-toolbar-title {
        color: #000 !important;
    }
    #events-list {
        background: #FFE600;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid #000;
    }
    .event-item {
        padding: 1rem;
        border-bottom: 1px solid #000;
    }
    .event-item:last-child {
        border-bottom: none;
    }
    .event-date {
        font-weight: bold;
        color: #FF8C00;
    }
</style>

<script>
    const events = [
        {% for page in section.pages %}
        {
            title: "{{ page.title }}",
            start: "{{ page.date }}",
            {% if page.end_date %}
            end: "{{ page.end_date }}",
            {% endif %}
            allDay: true,
            url: "{{ config.base_url | safe }}{{ page.path | safe }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: events,
            eventClick: function(info) {
                info.jsEvent.preventDefault();
                if (info.event.url) {
                    window.location.href = info.event.url;
                }
            },
            locale: 'pl',
            buttonText: {
                today: 'Dzisiaj',
                month: 'Miesiąc',
                week: 'Tydzień',
                day: 'Dzień'
            },
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,listWeek'
            }
        });
        calendar.render();

        const listEl = document.getElementById('events-list');
        const sortedEvents = [...events].sort((a, b) => new Date(a.start) - new Date(b.start));
        
        sortedEvents.forEach(event => {
            const startDate = new Date(event.start);
            const endDate = event.end ? new Date(event.end) : null;
            
            let dateStr;
            if (endDate && endDate.getTime() !== startDate.getTime()) {
                const endStr = endDate.toLocaleDateString('pl-PL', { day: 'numeric', month: 'long' });
                dateStr = startDate.toLocaleDateString('pl-PL', { weekday: 'long', day: 'numeric', month: 'long' }) + ' - ' + endStr;
            } else {
                dateStr = startDate.toLocaleDateString('pl-PL', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            }
            
            const item = document.createElement('div');
            item.className = 'event-item';
            item.innerHTML = `
                <div class="event-date">${dateStr}</div>
                <div><a href="${event.url}">${event.title}</a></div>
            `;
            listEl.appendChild(item);
        });
    });
</script>
{% endblock %}
